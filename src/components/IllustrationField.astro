---
/**
 * IllustrationField Component
 * 
 * Creates a scattered field of illustrations with subtle drift animations.
 * Uses CSS Grid with random transforms for pseudo-random positioning.
 * 
 * Variants:
 * - hero: Large, sparse field for the homepage hero section
 * - dense: Tighter grid with more objects for visual richness
 * - minimal: Few objects, subtle positioning
 */

interface Props {
  variant?: 'hero' | 'dense' | 'minimal';
  class?: string;
}

const { variant = 'hero', class: className = '' } = Astro.props;

// Placeholder illustrations until we generate real ones
// These use simple SVG shapes in our color palette
const placeholderIllustrations = [
  { id: 'circle-1', color: '#FF9B9B', shape: 'circle' },
  { id: 'circle-2', color: '#A8D5BA', shape: 'circle' },
  { id: 'circle-3', color: '#FFE5A3', shape: 'circle' },
  { id: 'square-1', color: '#B5D8EB', shape: 'square' },
  { id: 'square-2', color: '#E8C5E5', shape: 'square' },
  { id: 'circle-4', color: '#FFD4A3', shape: 'circle' },
  { id: 'circle-5', color: '#C5E8E0', shape: 'circle' },
  { id: 'square-3', color: '#FFB5B5', shape: 'square' },
  { id: 'circle-6', color: '#D5C8E8', shape: 'circle' },
  { id: 'circle-7', color: '#B8E0D2', shape: 'circle' },
  { id: 'square-4', color: '#F5D5C8', shape: 'square' },
  { id: 'circle-8', color: '#C8E0F5', shape: 'circle' },
];

// Pre-defined positions for predictable, harmonious layout
// Each position is [x%, y%, rotation, scale, animationClass]
const heroPositions = [
  [5, 15, -8, 0.8, 'animate-drift'],
  [15, 75, 5, 0.6, 'animate-drift-alt'],
  [25, 25, -3, 0.9, 'animate-drift-slow'],
  [35, 85, 8, 0.7, 'animate-drift'],
  [55, 10, -5, 0.75, 'animate-drift-alt'],
  [65, 70, 3, 0.85, 'animate-drift-slow'],
  [75, 35, -10, 0.65, 'animate-drift'],
  [85, 80, 6, 0.9, 'animate-drift-alt'],
  [90, 20, -4, 0.7, 'animate-drift-slow'],
  [45, 60, 7, 0.55, 'animate-drift'],
  [10, 45, -6, 0.6, 'animate-drift-alt'],
  [80, 55, 4, 0.75, 'animate-drift-slow'],
];

const densePositions = [
  ...heroPositions,
  [20, 50, 4, 0.5, 'animate-drift'],
  [40, 30, -7, 0.6, 'animate-drift-alt'],
  [60, 45, 5, 0.55, 'animate-drift-slow'],
  [30, 65, -4, 0.65, 'animate-drift'],
  [70, 25, 8, 0.5, 'animate-drift-alt'],
  [50, 80, -6, 0.7, 'animate-drift-slow'],
];

const minimalPositions = [
  [10, 20, -5, 0.7, 'animate-drift'],
  [85, 30, 5, 0.8, 'animate-drift-alt'],
  [20, 75, 3, 0.65, 'animate-drift-slow'],
  [75, 70, -4, 0.75, 'animate-drift'],
];

const positions = variant === 'dense' ? densePositions : variant === 'minimal' ? minimalPositions : heroPositions;

// Select illustrations for the positions
const selectedIllustrations = positions.map((pos, i) => ({
  ...placeholderIllustrations[i % placeholderIllustrations.length],
  position: pos,
}));
---

<div class:list={["illustration-field", `illustration-field--${variant}`, className]} aria-hidden="true">
  {selectedIllustrations.map(({ id, color, shape, position }) => {
    const [x, y, rotation, scale, animClass] = position;
    const size = shape === 'circle' ? 40 + Math.random() * 30 : 30 + Math.random() * 25;
    
    return (
      <div 
        class={`illustration-item ${animClass}`}
        style={`
          left: ${x}%;
          top: ${y}%;
          transform: rotate(${rotation}deg) scale(${scale});
          animation-delay: ${Math.random() * 5}s;
        `}
      >
        {shape === 'circle' ? (
          <svg width={size} height={size} viewBox="0 0 40 40">
            <circle cx="20" cy="20" r="18" fill={color} />
          </svg>
        ) : (
          <svg width={size} height={size} viewBox="0 0 40 40">
            <rect x="4" y="4" width="32" height="32" rx="8" fill={color} />
          </svg>
        )}
      </div>
    );
  })}
</div>

<style>
  .illustration-field {
    position: absolute;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
    z-index: 0;
  }
  
  .illustration-item {
    position: absolute;
    opacity: 0.6;
    transition: opacity 0.3s ease;
  }
  
  .illustration-field--hero .illustration-item {
    opacity: 0.5;
  }
  
  .illustration-field--dense .illustration-item {
    opacity: 0.4;
  }
  
  .illustration-field--minimal .illustration-item {
    opacity: 0.6;
  }
  
  /* Subtle hover effect on parent container */
  .illustration-field:hover .illustration-item {
    opacity: 0.7;
  }
  
  /* Import motion styles for animations */
  .animate-drift {
    animation: drift 15s ease-in-out infinite;
  }
  
  .animate-drift-alt {
    animation: drift-alt 18s ease-in-out infinite;
  }
  
  .animate-drift-slow {
    animation: drift 22s ease-in-out infinite;
  }
  
  @keyframes drift {
    0%, 100% {
      transform: translate(0, 0) rotate(var(--rotation, 0deg));
    }
    25% {
      transform: translate(2px, -3px) rotate(calc(var(--rotation, 0deg) + 0.5deg));
    }
    50% {
      transform: translate(3px, -5px) rotate(calc(var(--rotation, 0deg) + 1deg));
    }
    75% {
      transform: translate(1px, -2px) rotate(calc(var(--rotation, 0deg) + 0.3deg));
    }
  }
  
  @keyframes drift-alt {
    0%, 100% {
      transform: translate(0, 0) rotate(var(--rotation, 0deg));
    }
    25% {
      transform: translate(-2px, 2px) rotate(calc(var(--rotation, 0deg) - 0.5deg));
    }
    50% {
      transform: translate(-4px, 4px) rotate(calc(var(--rotation, 0deg) - 1deg));
    }
    75% {
      transform: translate(-1px, 1px) rotate(calc(var(--rotation, 0deg) - 0.3deg));
    }
  }
  
  @media (prefers-reduced-motion: reduce) {
    .illustration-item {
      animation: none !important;
    }
  }
  
  /* Hide on very small screens to reduce visual noise */
  @media (max-width: 480px) {
    .illustration-field {
      display: none;
    }
  }
</style>
